=== Netplan: Configuración de Red en Ubuntu
:toc:
:toclevels: 3
:sectnums:

==== Introducción a Netplan

*Netplan* es una herramienta de configuración de red utilizada en sistemas **Ubuntu 18.04 y posteriores**. Permite definir de forma declarativa la configuración de red del sistema, tanto en entornos cliente como servidor, gestionando interfaces internas, externas y sus propiedades.

En versiones anteriores de Ubuntu y en Debian clásicos, la configuración de red se realizaba mediante el archivo:

[source]
----
/etc/network/interfaces
----

Netplan actúa como capa de abstracción y genera la configuración final para el backend correspondiente (*systemd-networkd* o *NetworkManager*).

==== Archivos y Requisitos

El archivo de configuración principal de Netplan se encuentra en:

[source]
----
/etc/netplan/01-network-manager-all.yml
----

* Es imprescindible editar este archivo con **privilegios de superusuario**.
* Si no se utilizan permisos adecuados, el sistema no permitirá guardar los cambios.

Para aplicar la configuración definida en Netplan se utiliza:

[source,bash]
----
sudo netplan apply
----

Para verificar que los cambios se han aplicado correctamente:

[source,bash]
----
ip a
----

En caso de errores de sintaxis o indentación, Netplan mostrará mensajes detallados indicando **la línea exacta y el tipo de error**, lo que facilita su corrección.

==== Importancia de la Indentación (YAML)

Netplan utiliza el formato **YAML**, donde la indentación es crítica:

* Cada nivel jerárquico se define mediante **dos espacios**.
* No se deben usar tabulaciones.
* Una indentación incorrecta provoca errores de configuración.

La estructura es jerárquica y heredada: cada subnivel depende directamente del nivel superior.

==== Estructura Básica de Netplan

[source,yaml]
----
network:
  version: 2
  renderer: networkd
  ethernets:
    INTERFAZ:
      CONFIGURACIÓN
----

Elementos principales:

* `version`: versión del esquema (siempre `2`).
* `renderer`:
** `networkd` (habitual en servidores).
** `NetworkManager` (habitual en escritorios).
* `ethernets`: interfaces Ethernet.
* `wifis`: interfaces inalámbricas (no tratadas aquí).

==== Ejemplo con Varias Interfaces

En el siguiente ejemplo se configuran **dos interfaces de red** con comportamientos distintos:

* `enp0s3`: configuración estática.
* `enp0s8`: configuración dinámica mediante DHCP.

[source,diff]
----
network:
  version: 2
  renderer: networkd
  ethernets:
    enp0s3:
-     dhcp4: no
      addresses: [192.168.1.2/24]
      gateway4: 192.168.1.1
    enp0s8:
      dhcp4: true
-     #addresses: [40.0.0.2/8]
-     #gateway4: 40.0.0.1
----

Notas importantes:

* Si `dhcp4` está en `true`, las opciones `addresses` y `gateway4` **no se aplican**, aunque estén presentes.
* Es recomendable **comentar** las opciones no utilizadas para evitar confusión.
* Las líneas comentadas no afectan a la configuración final.

==== Configuración de Conexión Estática

Configuración de una interfaz con IP fija:

[source,yaml]
----
network:
  version: 2
  renderer: networkd
  ethernets:
    enp0s3:
      dhcp4: no
      addresses: [40.0.0.2/8]
      gateway4: 40.0.0.1
    enp0s8:
      dhcp4: true
      #addresses: [40.0.0.3/8]
      #gateway4: 40.0.0.1
----

Características:

* IP persistente.
* Recomendado para servidores.
* Control total sobre direccionamiento y enrutamiento.

==== Configuración de Conexión Dinámica (DHCP)

Configuración de una interfaz con asignación automática de IP:

[source,yaml]
----
network:
  version: 2
  renderer: networkd
  ethernets:
    enp0s3:
      dhcp4: true
----

Características:

* IP no persistente.
* Configuración sencilla.
* Ideal para clientes, redes domésticas y entornos virtualizados.

La interfaz (`enp0s3`, `enp0s8`, etc.) puede variar según el sistema. Para identificarla correctamente:

[source,bash]
----
ip a
----

==== Resumen Práctico

* Netplan se usa en Ubuntu 18+.
* Utiliza YAML, la indentación es crítica.
* `dhcp4: true` invalida configuraciones estáticas.
* Los cambios se aplican con `netplan apply`.
* Los errores se detectan en tiempo de aplicación.

